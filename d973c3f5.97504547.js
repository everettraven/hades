(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{77:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return i})),n.d(t,"default",(function(){return u}));var o=n(3),r=n(7),a=(n(0),n(84)),l={id:"host_file",title:"Host File"},s={unversionedId:"guides/host_file",id:"guides/host_file",isDocsHomePage:!1,title:"Host File",description:"This guide shows how to use hades with a simple test file that runs a very simple command. All source code for this example can be found here",source:"@site/docs\\guides\\host_file.md",slug:"/guides/host_file",permalink:"/hades/guides/host_file",editUrl:"https://github.com/everettraven/hades/edit/main/docs/docs/guides/host_file.md",version:"current",sidebar:"someSidebar",previous:{title:"Simple Command",permalink:"/hades/guides/simple_command"},next:{title:"Multiple Tests",permalink:"/hades/guides/multiple_tests"}},i=[{value:"Docker Setup",id:"docker-setup",children:[]},{value:"Create the Test File",id:"create-the-test-file",children:[]},{value:"Run hades",id:"run-hades",children:[]},{value:"Docker Cleanup",id:"docker-cleanup",children:[]}],c={toc:i};function u(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"This guide shows how to use hades with a simple test file that runs a very simple command. All source code for this example can be found ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/everettraven/hades/tree/main/examples/host_file"}),"here")),Object(a.b)("p",null,"This guide uses Docker to create a container that would simulate a remote machine running on your local machine. If you have an existing remote machine feel free to skip the Docker setup steps."),Object(a.b)("p",null,"This guide can also be run locally by passing the ",Object(a.b)("inlineCode",{parentName:"p"},"--local")," flag when running hades. It is important to note that this guide was made to run with the Docker container so some changes may need to be made in order for all the tests to pass when running them locally. If you are running it locally on a Windows system, changes will need to be made to the tests as the test commands on Windows results in a different output than the Ubuntu 20.04 Docker container."),Object(a.b)("h2",{id:"docker-setup"},"Docker Setup"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Make sure that you have docker installed by running:")),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"docker -v\n")),Object(a.b)("p",null,"If you do not have Docker installed you can install it by following the offical Docker installation instructions: ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://docs.docker.com/get-docker/"}),"https://docs.docker.com/get-docker/")),Object(a.b)("ol",{start:2},Object(a.b)("li",{parentName:"ol"},"Pull the Docker Image we are going to use by running:")),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"docker pull bpalmer/ssh_test\n")),Object(a.b)("ol",{start:3},Object(a.b)("li",{parentName:"ol"},"Run the Docker Container by running:")),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"docker run --name host_file -d -p 5000:22 bpalmer/ssh_test\n")),Object(a.b)("p",null,"This will run the Docker Container in the background with your localhost port 5000 mapped to port 22 (the standard SSH port) on the Docker Container. It also names the container 'host_file' for easy cleanup when we are done with it. Feel free to play with these values as you see fit, but make sure to adjust where these values are used in the future pieces of the guide."),Object(a.b)("p",null,"For reference:"),Object(a.b)("p",null,"Both the username and password for this Docker Container is ",Object(a.b)("strong",{parentName:"p"},"root")),Object(a.b)("h2",{id:"create-the-test-file"},"Create the Test File"),Object(a.b)("p",null,"Make sure you are in the directory you would like to store the source code of this guide in and make your test file. We are going to name it ",Object(a.b)("strong",{parentName:"p"},"test.hcl"),". The .hcl file extension is required and signifies that is a Hashicorp Configuration Language file. Open the file in your IDE or text editor and add the following to it:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-hcl"}),'title = "Hosts file test"\n\ncommand {\n    cmd = "echo"\n    args = ["Hello Infrastructure Testing World!"]\n    expectedOutput = "Hello Infrastructure Testing World!"\n}\n\nos {\n    distributionID = "Ubuntu"\n    version = "20.04"\n}\n')),Object(a.b)("p",null,"You can also do the following to get rid of the optional args parameter in the command block and the optional version parameter in the os block if you would like:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-hcl"}),'title = "Hosts file test"\n\ncommand {\n    cmd = "echo Hello Infrastructure Testing World!"\n    expectedOutput = "Hello Infrastructure Testing World!"\n}\n\nos {\n    distributionID = "Ubuntu"\n}\n')),Object(a.b)("p",null,"We recommend that you create a hosts folder for better organization, but it is not necessary when creating the ",Object(a.b)("strong",{parentName:"p"},"hosts.hcl")," file as hades will look for it as long as it is in the current directory or a sub-directory of the current directory. In our case we are going to create the hosts folder and then within that folder create the ",Object(a.b)("strong",{parentName:"p"},"hosts.hcl")," file. In the ",Object(a.b)("strong",{parentName:"p"},"hosts.hcl")," file we are going to put the following:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-hcl"}),'host {\n    ip = "127.0.0.1"\n    port = "5000"\n    user = "root"\n}\n')),Object(a.b)("p",null,"If you wanted to run the tests on multiple hosts you can place multiple host blocks in the hosts file. hades will run all the tests on each of the hosts."),Object(a.b)("h2",{id:"run-hades"},"Run hades"),Object(a.b)("p",null,"Now that we have a simple test file created we can run hades to test the remote system. In this case we will run it on our Docker Container we created for this guide by running:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"hades --pass root test.hcl\n")),Object(a.b)("p",null,"Run it locally (does not require authentication):"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"hades --local test.hcl\n")),Object(a.b)("p",null,"It is not recommended to run hades by passing the ",Object(a.b)("inlineCode",{parentName:"p"},"--pass")," flag to the command as this puts the password for the remote machine in your command line history as plaintext. We recommend running hades using an SSH key. If you are interested in doing so we first need to do some setup:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Create an SSH key by running:")),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"ssh-keygen\n")),Object(a.b)("ol",{start:2},Object(a.b)("li",{parentName:"ol"},"Send the SSH key to the remote system (or Docker Container in this case):")),Object(a.b)("p",null,"Windows (Powershell):"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-powershell"}),'type $env:USERPROFILE\\.ssh\\id_rsa.pub | ssh root@127.0.0.1 -p 5000 "cat >> .ssh/authorized_keys"\n')),Object(a.b)("p",null,"Unix:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"ssh-copy-id -i ~/.ssh/id_rsa root@127.0.0.1 -p 5000\n")),Object(a.b)("p",null,"Now that the SSH Key has been sent to the remote system we can run hades with the SSH key. By default hades attempts to get the SSH key from ",Object(a.b)("inlineCode",{parentName:"p"},"~/.ssh/id_rsa")," so if you created the key to a different directory you can use the flag ",Object(a.b)("inlineCode",{parentName:"p"},"--key-file")," followed by the path to the SSH key."),Object(a.b)("p",null,"Running hades with the SSH Key:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"hades test.hcl\n")),Object(a.b)("p",null,"Running hades with a non-default SSH Key path:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"hades --key-file [key path] test.hcl\n")),Object(a.b)("h2",{id:"docker-cleanup"},"Docker Cleanup"),Object(a.b)("p",null,"All the guides use Docker Containers so if you plan to continue with the rest of the guides you can return to this step when you are finished with the guides you would like to go through."),Object(a.b)("p",null,"If you would like to cleanup the Docker Container now you can run the following commands to stop and remove the Docker Container:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"docker container stop host_file\n")),Object(a.b)("p",null,"and"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"docker container rm host_file\n")),Object(a.b)("p",null,"All the guides will use the same Docker Image for their Containers, but if you would like to remove the image as well you can run:"),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"docker image rm bpalmer/ssh_test\n")))}u.isMDXComponent=!0},84:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return d}));var o=n(0),r=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=r.a.createContext({}),u=function(e){var t=r.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},h=function(e){var t=u(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},p=r.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),h=u(n),p=o,d=h["".concat(l,".").concat(p)]||h[p]||b[p]||a;return n?r.a.createElement(d,s(s({ref:t},c),{},{components:n})):r.a.createElement(d,s({ref:t},c))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,l=new Array(a);l[0]=p;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,l[1]=s;for(var c=2;c<a;c++)l[c]=n[c];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);